module test.nm64.nm64_gen04;

import std.stdio;
import std.string;
import std.exception;
import xbyak;
import test.test_count;

version (X86) version = XBYAK32;
version (X86_64) version = XBYAK64;

version (XBYAK64)
{

    @("nm64_gen04")
    unittest
    {
        class gen04 : CodeGenerator
        {
            TestCount testCount;

            void sdump(string hexStr, string file = __FILE__, size_t line = __LINE__)
            {
                if (hexStr.length == 0)
                {
                    dump();
                    size_ = 0;
                    return;
                }

                const size_t n = this.getSize();
                auto ctbl = this.getCode();

                string hexCode;
                for (size_t i = 0; i < n; i++)
                {
                    hexCode ~= format("%02X", ctbl[i]);
                }

                testCount.TEST_EQUAL(hexCode, hexStr, file, line);
                size_ = 0;
                return;
            }

            ~this()
            {
                testCount.end("nm64_gen04");
            }

            this()
            {
                testCount.reset();
                psllw(mm0, 4);
                sdump("0F71F004");
                psllw(mm4, 0xda);
                sdump("0F71F4DA");
                psllw(xmm1, 4);
                sdump("660F71F104");
                psllw(xmm2, 0xda);
                sdump("660F71F2DA");
                psllw(xmm12, 4);
                sdump("66410F71F404");
                psllw(xmm11, 0xda);
                sdump("66410F71F3DA");
                pslld(mm4, 4);
                sdump("0F72F404");
                pslld(mm1, 0xda);
                sdump("0F72F1DA");
                pslld(xmm2, 4);
                sdump("660F72F204");
                pslld(xmm3, 0xda);
                sdump("660F72F3DA");
                pslld(xmm8, 4);
                sdump("66410F72F004");
                pslld(xmm10, 0xda);
                sdump("66410F72F2DA");
                psllq(mm7, 4);
                sdump("0F73F704");
                psllq(mm3, 0xda);
                sdump("0F73F3DA");
                psllq(xmm4, 4);
                sdump("660F73F404");
                psllq(xmm1, 0xda);
                sdump("660F73F1DA");
                psllq(xmm14, 4);
                sdump("66410F73F604");
                psllq(xmm9, 0xda);
                sdump("66410F73F1DA");
                psraw(mm7, 4);
                sdump("0F71E704");
                psraw(mm2, 0xda);
                sdump("0F71E2DA");
                psraw(xmm7, 4);
                sdump("660F71E704");
                psraw(xmm0, 0xda);
                sdump("660F71E0DA");
                psraw(xmm10, 4);
                sdump("66410F71E204");
                psraw(xmm12, 0xda);
                sdump("66410F71E4DA");
                psrad(mm2, 4);
                sdump("0F72E204");
                psrad(mm3, 0xda);
                sdump("0F72E3DA");
                psrad(xmm2, 4);
                sdump("660F72E204");
                psrad(xmm0, 0xda);
                sdump("660F72E0DA");
                psrad(xmm15, 4);
                sdump("66410F72E704");
                psrad(xmm14, 0xda);
                sdump("66410F72E6DA");
                psrlw(mm3, 4);
                sdump("0F71D304");
                psrlw(mm4, 0xda);
                sdump("0F71D4DA");
                psrlw(xmm3, 4);
                sdump("660F71D304");
                psrlw(xmm0, 0xda);
                sdump("660F71D0DA");
                psrlw(xmm9, 4);
                sdump("66410F71D104");
                psrlw(xmm10, 0xda);
                sdump("66410F71D2DA");
                psrld(mm4, 4);
                sdump("0F72D404");
                psrld(mm2, 0xda);
                sdump("0F72D2DA");
                psrld(xmm5, 4);
                sdump("660F72D504");
                psrld(xmm7, 0xda);
                sdump("660F72D7DA");
                psrld(xmm10, 4);
                sdump("66410F72D204");
                psrld(xmm15, 0xda);
                sdump("66410F72D7DA");
                psrlq(mm6, 4);
                sdump("0F73D604");
                psrlq(mm5, 0xda);
                sdump("0F73D5DA");
                psrlq(xmm0, 4);
                sdump("660F73D004");
                psrlq(xmm5, 0xda);
                sdump("660F73D5DA");
                psrlq(xmm8, 4);
                sdump("66410F73D004");
                psrlq(xmm13, 0xda);
                sdump("66410F73D5DA");
                pslldq(xmm6, 4);
                sdump("660F73FE04");
                pslldq(xmm3, 0xda);
                sdump("660F73FBDA");
                pslldq(xmm12, 4);
                sdump("66410F73FC04");
                pslldq(xmm15, 0xda);
                sdump("66410F73FFDA");
                psrldq(xmm7, 4);
                sdump("660F73DF04");
                psrldq(xmm1, 0xda);
                sdump("660F73D9DA");
                psrldq(xmm13, 4);
                sdump("66410F73DD04");
                psrldq(xmm11, 0xda);
                sdump("66410F73DBDA");
                pmovmskb(esp, mm2);
                sdump("0FD7E2");
                pmovmskb(ebx, xmm7);
                sdump("660FD7DF");
                pmovmskb(ecx, xmm13);
                sdump("66410FD7CD");
                pmovmskb(eax, mm0);
                sdump("0FD7C0");
                pmovmskb(eax, xmm5);
                sdump("660FD7C5");
                pmovmskb(eax, xmm15);
                sdump("66410FD7C7");
                pmovmskb(r13d, mm7);
                sdump("440FD7EF");
                pmovmskb(r10d, xmm4);
                sdump("66440FD7D4");
                pmovmskb(r10d, xmm13);
                sdump("66450FD7D5");
                pextrw(ebx, mm7, 4);
                sdump("0FC5DF04");
                pextrw(ecx, mm4, 0xda);
                sdump("0FC5CCDA");
                pextrw(edi, xmm6, 4);
                sdump("660FC5FE04");
                pextrw(ebp, xmm6, 0xda);
                sdump("660FC5EEDA");
                pextrw(edx, xmm15, 4);
                sdump("66410FC5D704");
                pextrw(ebx, xmm12, 0xda);
                sdump("66410FC5DCDA");
                pextrw(eax, mm6, 4);
                sdump("0FC5C604");
                pextrw(eax, mm4, 0xda);
                sdump("0FC5C4DA");
                pextrw(eax, xmm7, 4);
                sdump("660FC5C704");
                pextrw(eax, xmm1, 0xda);
                sdump("660FC5C1DA");
                pextrw(eax, xmm12, 4);
                sdump("66410FC5C404");
                pextrw(eax, xmm11, 0xda);
                sdump("66410FC5C3DA");
                pextrw(r8d, mm1, 4);
                sdump("440FC5C104");
                pextrw(r13d, mm3, 0xda);
                sdump("440FC5EBDA");
                pextrw(r8d, xmm3, 4);
                sdump("66440FC5C304");
                pextrw(r14d, xmm4, 0xda);
                sdump("66440FC5F4DA");
                pextrw(r11d, xmm10, 4);
                sdump("66450FC5DA04");
                pextrw(r9d, xmm15, 0xda);
                sdump("66450FC5CFDA");
                pinsrw(mm7, ptr[eax + ecx + 3], 4);
                sdump("670FC47C080304");
                pinsrw(mm2, ptr[eax + ecx + 3], 0xda);
                sdump("670FC4540803DA");
                pinsrw(mm2, ecx, 4);
                sdump("0FC4D104");
                pinsrw(mm6, ecx, 0xda);
                sdump("0FC4F1DA");
                pinsrw(mm4, eax, 4);
                sdump("0FC4E004");
                pinsrw(mm3, eax, 0xda);
                sdump("0FC4D8DA");
                pinsrw(mm3, ptr[rdx + r15 + 0x12], 4);
                sdump("420FC45C3A1204");
                pinsrw(mm5, ptr[rdx + r15 + 0x12], 0xda);
                sdump("420FC46C3A12DA");
                pinsrw(mm2, r12d, 4);
                sdump("410FC4D404");
                pinsrw(mm4, r11d, 0xda);
                sdump("410FC4E3DA");
                pinsrw(xmm0, ptr[eax + ecx + 3], 4);
                sdump("66670FC444080304");
                pinsrw(xmm3, ptr[eax + ecx + 3], 0xda);
                sdump("66670FC45C0803DA");
                pinsrw(xmm7, esp, 4);
                sdump("660FC4FC04");
                pinsrw(xmm6, ebx, 0xda);
                sdump("660FC4F3DA");
                pinsrw(xmm7, eax, 4);
                sdump("660FC4F804");
                pinsrw(xmm0, eax, 0xda);
                sdump("660FC4C0DA");
                pinsrw(xmm2, ptr[rdx + r15 + 0x12], 4);
                sdump("66420FC4543A1204");
                pinsrw(xmm5, ptr[rdx + r15 + 0x12], 0xda);
                sdump("66420FC46C3A12DA");
                pinsrw(xmm5, r15d, 4);
                sdump("66410FC4EF04");
                pinsrw(xmm4, r11d, 0xda);
                sdump("66410FC4E3DA");
                pinsrw(xmm13, ptr[eax + ecx + 3], 4);
                sdump("6667440FC46C080304");
                pinsrw(xmm8, ptr[eax + ecx + 3], 0xda);
                sdump("6667440FC4440803DA");
                pinsrw(xmm12, ebx, 4);
                sdump("66440FC4E304");
                pinsrw(xmm9, edx, 0xda);
                sdump("66440FC4CADA");
                pinsrw(xmm11, eax, 4);
                sdump("66440FC4D804");
                pinsrw(xmm11, eax, 0xda);
                sdump("66440FC4D8DA");
                pinsrw(xmm11, ptr[rdx + r15 + 0x12], 4);
                sdump("66460FC45C3A1204");
                pinsrw(xmm14, ptr[rdx + r15 + 0x12], 0xda);
                sdump("66460FC4743A12DA");
                pinsrw(xmm15, r9d, 4);
                sdump("66450FC4F904");
                pinsrw(xmm12, r12d, 0xda);
                sdump("66450FC4E4DA");
                pshufw(mm2, mm0, 4);
                sdump("0F70D004");
                pshufw(mm7, mm6, 0xda);
                sdump("0F70FEDA");
                pshufw(mm1, ptr[eax + ecx + 3], 4);
                sdump("670F704C080304");
                pshufw(mm5, ptr[eax + ecx + 3], 0xda);
                sdump("670F706C0803DA");
                pshufw(mm2, ptr[rdx + r15 + 0x12], 4);
                sdump("420F70543A1204");
                pshufw(mm5, ptr[rdx + r15 + 0x12], 0xda);
                sdump("420F706C3A12DA");
                pshuflw(xmm4, xmm4, 4);
                sdump("F20F70E404");
                pshuflw(xmm7, xmm3, 0xda);
                sdump("F20F70FBDA");
                pshuflw(xmm6, ptr[eax + ecx + 3], 4);
                sdump("F2670F7074080304");
                pshuflw(xmm0, ptr[eax + ecx + 3], 0xda);
                sdump("F2670F70440803DA");
                pshuflw(xmm1, ptr[rdx + r15 + 0x12], 4);
                sdump("F2420F704C3A1204");
                pshuflw(xmm3, ptr[rdx + r15 + 0x12], 0xda);
                sdump("F2420F705C3A12DA");
                pshuflw(xmm2, xmm14, 4);
                sdump("F2410F70D604");
                pshuflw(xmm0, xmm11, 0xda);
                sdump("F2410F70C3DA");
                pshuflw(xmm8, xmm4, 4);
                sdump("F2440F70C404");
                pshuflw(xmm8, xmm1, 0xda);
                sdump("F2440F70C1DA");
                pshuflw(xmm12, ptr[eax + ecx + 3], 4);
                sdump("F267440F7064080304");
                pshuflw(xmm8, ptr[eax + ecx + 3], 0xda);
                sdump("F267440F70440803DA");
                pshuflw(xmm14, ptr[rdx + r15 + 0x12], 4);
                sdump("F2460F70743A1204");
                pshuflw(xmm14, ptr[rdx + r15 + 0x12], 0xda);
                sdump("F2460F70743A12DA");
                pshuflw(xmm8, xmm9, 4);
                sdump("F2450F70C104");
                pshuflw(xmm11, xmm11, 0xda);
                sdump("F2450F70DBDA");
                pshufhw(xmm6, xmm5, 4);
                sdump("F30F70F504");
                pshufhw(xmm0, xmm4, 0xda);
                sdump("F30F70C4DA");
                pshufhw(xmm0, ptr[eax + ecx + 3], 4);
                sdump("F3670F7044080304");
                pshufhw(xmm6, ptr[eax + ecx + 3], 0xda);
                sdump("F3670F70740803DA");
                pshufhw(xmm7, ptr[rdx + r15 + 0x12], 4);
                sdump("F3420F707C3A1204");
                pshufhw(xmm3, ptr[rdx + r15 + 0x12], 0xda);
                sdump("F3420F705C3A12DA");
                pshufhw(xmm0, xmm10, 4);
                sdump("F3410F70C204");
                pshufhw(xmm0, xmm9, 0xda);
                sdump("F3410F70C1DA");
                pshufhw(xmm13, xmm7, 4);
                sdump("F3440F70EF04");
                pshufhw(xmm13, xmm2, 0xda);
                sdump("F3440F70EADA");
                pshufhw(xmm10, ptr[eax + ecx + 3], 4);
                sdump("F367440F7054080304");
                pshufhw(xmm14, ptr[eax + ecx + 3], 0xda);
                sdump("F367440F70740803DA");
                pshufhw(xmm10, ptr[rdx + r15 + 0x12], 4);
                sdump("F3460F70543A1204");
                pshufhw(xmm11, ptr[rdx + r15 + 0x12], 0xda);
                sdump("F3460F705C3A12DA");
                pshufhw(xmm11, xmm12, 4);
                sdump("F3450F70DC04");
                pshufhw(xmm10, xmm13, 0xda);
                sdump("F3450F70D5DA");
                pshufd(xmm2, xmm6, 4);
                sdump("660F70D604");
                pshufd(xmm5, xmm6, 0xda);
                sdump("660F70EEDA");
                pshufd(xmm7, ptr[eax + ecx + 3], 4);
                sdump("66670F707C080304");
                pshufd(xmm2, ptr[eax + ecx + 3], 0xda);
                sdump("66670F70540803DA");
                pshufd(xmm0, ptr[rdx + r15 + 0x12], 4);
                sdump("66420F70443A1204");
                pshufd(xmm3, ptr[rdx + r15 + 0x12], 0xda);
                sdump("66420F705C3A12DA");
                pshufd(xmm2, xmm14, 4);
                sdump("66410F70D604");
                pshufd(xmm5, xmm9, 0xda);
                sdump("66410F70E9DA");
                pshufd(xmm9, xmm4, 4);
                sdump("66440F70CC04");
                pshufd(xmm13, xmm4, 0xda);
                sdump("66440F70ECDA");
                pshufd(xmm11, ptr[eax + ecx + 3], 4);
                sdump("6667440F705C080304");
                pshufd(xmm14, ptr[eax + ecx + 3], 0xda);
                sdump("6667440F70740803DA");
                pshufd(xmm8, ptr[rdx + r15 + 0x12], 4);
                sdump("66460F70443A1204");
                pshufd(xmm10, ptr[rdx + r15 + 0x12], 0xda);
                sdump("66460F70543A12DA");
                pshufd(xmm13, xmm11, 4);
                sdump("66450F70EB04");
                pshufd(xmm9, xmm15, 0xda);
                sdump("66450F70CFDA");
                movdqa(xmm3, xmm7);
                sdump("660F6FDF");
                movdqa(xmm5, ptr[eax + ecx + 3]);
                sdump("66670F6F6C0803");
                movdqa(xmm2, ptr[rdx + r15 + 0x12]);
                sdump("66420F6F543A12");
                movdqa(xmm7, xmm11);
                sdump("66410F6FFB");
                movdqa(xmm15, xmm4);
                sdump("66440F6FFC");
                movdqa(xmm14, ptr[eax + ecx + 3]);
                sdump("6667440F6F740803");
                movdqa(xmm8, ptr[rdx + r15 + 0x12]);
                sdump("66460F6F443A12");
                movdqa(xmm11, xmm8);
                sdump("66450F6FD8");
                movdqa(ptr[eax + ecx + 3], xmm5);
                sdump("66670F7F6C0803");
                movdqa(ptr[eax + ecx + 3], xmm15);
                sdump("6667440F7F7C0803");
                movdqa(ptr[rdx + r15 + 0x12], xmm0);
                sdump("66420F7F443A12");
                movdqa(ptr[rdx + r15 + 0x12], xmm11);
                sdump("66460F7F5C3A12");
                movdqu(xmm6, xmm4);
                sdump("F30F6FF4");
                movdqu(xmm5, ptr[eax + ecx + 3]);
                sdump("F3670F6F6C0803");
                movdqu(xmm4, ptr[rdx + r15 + 0x12]);
                sdump("F3420F6F643A12");
                movdqu(xmm4, xmm13);
                sdump("F3410F6FE5");
                movdqu(xmm9, xmm7);
                sdump("F3440F6FCF");
                movdqu(xmm11, ptr[eax + ecx + 3]);
                sdump("F367440F6F5C0803");
                movdqu(xmm10, ptr[rdx + r15 + 0x12]);
                sdump("F3460F6F543A12");
                movdqu(xmm15, xmm9);
                sdump("F3450F6FF9");
                movdqu(ptr[eax + ecx + 3], xmm4);
                sdump("F3670F7F640803");
                movdqu(ptr[eax + ecx + 3], xmm11);
                sdump("F367440F7F5C0803");
                movdqu(ptr[rdx + r15 + 0x12], xmm6);
                sdump("F3420F7F743A12");
                movdqu(ptr[rdx + r15 + 0x12], xmm14);
                sdump("F3460F7F743A12");
                movaps(xmm3, xmm7);
                sdump("0F28DF");
                movaps(xmm3, ptr[eax + ecx + 3]);
                sdump("670F285C0803");
                movaps(xmm5, ptr[rdx + r15 + 0x12]);
                sdump("420F286C3A12");
                movaps(xmm5, xmm12);
                sdump("410F28EC");
                movaps(xmm8, xmm2);
                sdump("440F28C2");
                movaps(xmm11, ptr[eax + ecx + 3]);
                sdump("67440F285C0803");
                movaps(xmm12, ptr[rdx + r15 + 0x12]);
                sdump("460F28643A12");
                movaps(xmm15, xmm13);
                sdump("450F28FD");
                movaps(ptr[eax + ecx + 3], xmm2);
                sdump("670F29540803");
                movaps(ptr[eax + ecx + 3], xmm13);
                sdump("67440F296C0803");
                movaps(ptr[rdx + r15 + 0x12], xmm7);
                sdump("420F297C3A12");
                movaps(ptr[rdx + r15 + 0x12], xmm13);
                sdump("460F296C3A12");
                movss(xmm4, xmm3);
                sdump("F30F10E3");
                movss(xmm6, ptr[eax + ecx + 3]);
                sdump("F3670F10740803");
                movss(xmm2, ptr[rdx + r15 + 0x12]);
                sdump("F3420F10543A12");
                movss(xmm5, xmm14);
                sdump("F3410F10EE");
                movss(xmm15, xmm1);
                sdump("F3440F10F9");
                movss(xmm8, ptr[eax + ecx + 3]);
                sdump("F367440F10440803");
                movss(xmm12, ptr[rdx + r15 + 0x12]);
                sdump("F3460F10643A12");
                movss(xmm15, xmm10);
                sdump("F3450F10FA");
                movss(ptr[eax + ecx + 3], xmm1);
                sdump("F3670F114C0803");
                movss(ptr[eax + ecx + 3], xmm15);
                sdump("F367440F117C0803");
                movss(ptr[rdx + r15 + 0x12], xmm2);
                sdump("F3420F11543A12");
                movss(ptr[rdx + r15 + 0x12], xmm10);
                sdump("F3460F11543A12");
                movups(xmm3, xmm6);
                sdump("0F10DE");
                movups(xmm7, ptr[eax + ecx + 3]);
                sdump("670F107C0803");
                movups(xmm4, ptr[rdx + r15 + 0x12]);
                sdump("420F10643A12");
                movups(xmm0, xmm15);
                sdump("410F10C7");
                movups(xmm15, xmm6);
                sdump("440F10FE");
                movups(xmm9, ptr[eax + ecx + 3]);
                sdump("67440F104C0803");
                movups(xmm15, ptr[rdx + r15 + 0x12]);
                sdump("460F107C3A12");
                movups(xmm12, xmm13);
                sdump("450F10E5");
                movups(ptr[eax + ecx + 3], xmm2);
                sdump("670F11540803");
                movups(ptr[eax + ecx + 3], xmm11);
                sdump("67440F115C0803");
                movups(ptr[rdx + r15 + 0x12], xmm6);
                sdump("420F11743A12");
                movups(ptr[rdx + r15 + 0x12], xmm8);
                sdump("460F11443A12");
                movapd(xmm7, xmm6);
                sdump("660F28FE");
                movapd(xmm7, ptr[eax + ecx + 3]);
                sdump("66670F287C0803");
                movapd(xmm1, ptr[rdx + r15 + 0x12]);
                sdump("66420F284C3A12");
                movapd(xmm6, xmm13);
                sdump("66410F28F5");
                movapd(xmm9, xmm3);
                sdump("66440F28CB");
                movapd(xmm8, ptr[eax + ecx + 3]);
                sdump("6667440F28440803");
                movapd(xmm13, ptr[rdx + r15 + 0x12]);
                sdump("66460F286C3A12");
                movapd(xmm13, xmm10);
                sdump("66450F28EA");
                movapd(ptr[eax + ecx + 3], xmm4);
                sdump("66670F29640803");
                movapd(ptr[eax + ecx + 3], xmm12);
                sdump("6667440F29640803");
                movapd(ptr[rdx + r15 + 0x12], xmm4);
                sdump("66420F29643A12");
                movapd(ptr[rdx + r15 + 0x12], xmm8);
                sdump("66460F29443A12");
                movsd(xmm6, xmm6);
                sdump("F20F10F6");
                movsd(xmm1, ptr[eax + ecx + 3]);
                sdump("F2670F104C0803");
                movsd(xmm4, ptr[rdx + r15 + 0x12]);
                sdump("F2420F10643A12");
                movsd(xmm3, xmm10);
                sdump("F2410F10DA");
                movsd(xmm12, xmm3);
                sdump("F2440F10E3");
                movsd(xmm15, ptr[eax + ecx + 3]);
                sdump("F267440F107C0803");
                movsd(xmm14, ptr[rdx + r15 + 0x12]);
                sdump("F2460F10743A12");
                movsd(xmm14, xmm15);
                sdump("F2450F10F7");
                movsd(ptr[eax + ecx + 3], xmm7);
                sdump("F2670F117C0803");
                movsd(ptr[eax + ecx + 3], xmm11);
                sdump("F267440F115C0803");
                movsd(ptr[rdx + r15 + 0x12], xmm7);
                sdump("F2420F117C3A12");
                movsd(ptr[rdx + r15 + 0x12], xmm10);
                sdump("F2460F11543A12");
                movupd(xmm4, xmm6);
                sdump("660F10E6");
                movupd(xmm7, ptr[eax + ecx + 3]);
                sdump("66670F107C0803");
                movupd(xmm2, ptr[rdx + r15 + 0x12]);
                sdump("66420F10543A12");
                movupd(xmm4, xmm15);
                sdump("66410F10E7");
                movupd(xmm11, xmm6);
                sdump("66440F10DE");
                movupd(xmm8, ptr[eax + ecx + 3]);
                sdump("6667440F10440803");
                movupd(xmm9, ptr[rdx + r15 + 0x12]);
                sdump("66460F104C3A12");
                movupd(xmm8, xmm12);
                sdump("66450F10C4");
                movupd(ptr[eax + ecx + 3], xmm0);
                sdump("66670F11440803");
                movupd(ptr[eax + ecx + 3], xmm10);
                sdump("6667440F11540803");
                movupd(ptr[rdx + r15 + 0x12], xmm6);
                sdump("66420F11743A12");
                movupd(ptr[rdx + r15 + 0x12], xmm8);
                sdump("66460F11443A12");
                movq2dq(xmm3, mm6);
                sdump("F30FD6DE");
                movq2dq(xmm11, mm7);
                sdump("F3440FD6DF");
                movdq2q(mm5, xmm0);
                sdump("F20FD6E8");
                movdq2q(mm2, xmm8);
                sdump("F2410FD6D0");

            }
        }

        scope g4 = new gen04();
    }

}
